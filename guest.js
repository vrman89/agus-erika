(()=>{var P=(()=>{let a=null,s=null,r=0,g=0,p=!0,x=()=>{r+=1},E=()=>`(${g}/${r}) [${parseInt(g/r*100).toFixed(0)}%]`;return{init:()=>{a=document.getElementById("progress-info"),s=document.getElementById("progress-bar"),a.style.display="block"},add:x,invalid:c=>{p&&(p=!1,s.style.backgroundColor="red",a.innerText=`Error loading ${c} ${E()}`,document.dispatchEvent(new Event("progress.invalid")))},complete:(c,u=!1)=>{p&&(g+=1,a.innerText=`Loading ${c} ${u?"skipped":"complete"} ${E()}`,s.style.width=Math.min(g/r*100,100).toString()+"%",g===r&&document.dispatchEvent(new Event("progress.done")))}}})();var F=(()=>{let a=(t,n,d)=>({code:t,data:n,error:d}),s=(t=0)=>({love:t}),r=({uuid:t,own:n,name:d,presence:T,comment:v,created_at:A,is_admin:S,is_parent:m,gif_url:o,ip:f,user_agent:e,comments:w,like:L})=>({uuid:t,own:n,name:d,presence:T,comment:v,created_at:A,is_admin:S??!1,is_parent:m,gif_url:o,ip:f,user_agent:e,comments:w?.map(r)??[],like:s(L?.love??0)}),g=t=>t.map(r);return{uuidResponse:({uuid:t})=>({uuid:t}),baseResponse:a,tokenResponse:({token:t})=>({token:t}),statusResponse:({status:t})=>({status:t}),likeCommentResponse:s,getCommentResponse:r,getCommentsResponse:g,getCommentsResponseV2:t=>({count:t.count,lists:g(t.lists)}),commentShowMore:(t,n=!1)=>({uuid:t,show:n}),postCommentRequest:(t,n,d,T,v)=>({id:t,name:n,presence:d,comment:T,gif_id:v}),postSessionRequest:(t,n)=>({email:t,password:n}),updateCommentRequest:(t,n,d)=>({presence:t,comment:n,gif_id:d})}})();var G="GET",de="PUT",Q="POST",me="PATCH",ue="DELETE",te=200,se=201,Ee=500,ee="AbortError",Z={Accept:"application/json","Content-Type":"application/json"},N=(a,s)=>{let r=new AbortController,g={signal:r.signal,method:String(a).toUpperCase(),headers:new Headers(Z)};window.addEventListener("offline",()=>r.abort()),window.addEventListener("popstate",()=>r.abort());let p=0,x=0,E=0,k=0,b=document.body.getAttribute("data-url");b&&b.slice(-1)==="/"&&(b=b.slice(0,-1));let h=c=>{let u=()=>{let n=()=>window.fetch(c,g);if(p===0||!window.isSecureContext)return n();if(g.method!==G)return console.warn("Only method GET can be cached"),n();let d=T=>n().then(v=>{if(!v.ok)return v;let A=v.clone(),S=new Headers(v.headers);return v.clone().arrayBuffer().then(m=>{if(!S.has("Expires")){let o=new Date(Date.now()+p);S.set("Expires",o.toUTCString())}return S.has("Content-Length")||S.set("Content-Length",String(m.byteLength)),T.put(c,new Response(v.body,{headers:S})).then(()=>A)})});return window.caches.open("request").then(T=>T.match(c).then(v=>{if(!v)return d(T);let A=v.headers.get("Expires"),S=A?new Date(A).getTime():0;return Date.now()>S?T.delete(c).then(m=>m?d(T):v):v}))};if(x===0&&E===0)return u();let t=async()=>{try{return await u()}catch(n){if(n.name===ee)throw n;if(E*=2,k++,k>=x)throw new Error(`Max retries reached: ${n}`);return console.warn(`Retrying fetch (${k}/${x}): ${c}`),await new Promise(d=>window.setTimeout(d,E)),t()}};return t()};return{send(c=null){return h(b+s).then(u=>u.json().then(t=>{if(u.status>=Ee&&(t.message??t[0]))throw new Error(t.message??t[0]);if(t.error)throw new Error(t.error[0]);return c&&(t.data=c(t.data)),F.baseResponse(t.code,t.data,t.error)})).catch(u=>{if(u.name===ee)return console.warn("Fetch abort:",u),u;throw alert(u),new Error(u)})},withCache(c=1e3*60*60*6){return p=c,this},withRetry(c=3,u=1e3){return x=c,E=u,this},withCancel(c){return c==null?this:((async()=>(await c,r.abort()))(),this)},default(c=null){return g.headers=new Headers(c??{}),h(s)},download(){return Object.keys(Z).forEach(c=>g.headers.delete(c)),h(b+s).then(c=>{if(c.status!==te)return!1;let u=document.querySelector("a[download]");u&&document.body.removeChild(u);let t=c.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return c.blob().then(n=>{let d=document.createElement("a"),T=window.URL.createObjectURL(n);return d.href=T,d.download=t,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(T),!0})}).catch(c=>{if(c.name===ee)return console.warn("Fetch abort:",c),c;throw alert(c),new Error(c)})},token(c){return c.split(".").length===3?(g.headers.append("Authorization","Bearer "+c),this):(g.headers.append("x-access-key",c),this)},body(c){return g.body=JSON.stringify(c),this}}};var X=a=>{let s=new Map,r=new Map,g=null,p=1e3*60*60*6,x=async()=>{!g&&window.isSecureContext&&(g=await window.caches.open(a))},E=(b,h=null)=>{if(s.has(b))return Promise.resolve(s.get(b));if(r.has(b))return r.get(b);let c=x().then(()=>{let u=()=>N(G,b).withCancel(h).withRetry().default().then(n=>n.blob().then(d=>{if(!window.isSecureContext)return d;let T=new Headers(n.headers),v=new Date(Date.now()+p);T.set("Content-Length",String(d.size)),T.set("Expires",v.toUTCString());let A=d.slice();return g.put(b,new Response(d,{headers:T})).then(()=>A)})),t=n=>(s.set(b,URL.createObjectURL(n)),s.get(b));return window.isSecureContext?g.match(b).then(n=>{if(!n)return u();let d=n.headers.get("Expires"),T=d?new Date(d).getTime():0;return Date.now()>T?g.delete(b).then(v=>v?u():n.blob()):n.blob()}).then(n=>t(n)):u().then(n=>t(n))}).finally(()=>{r.delete(b)});return r.set(b,c),c};return{run:async(b,h=null)=>{await x();let c=new Map;return window.isSecureContext||console.warn("Cache is not supported in insecure context"),b.filter(u=>u!==null).forEach(u=>{let t=c.get(u.url)??[];c.set(u.url,[...t,[u.res,u?.rej]])}),Promise.allSettled(Array.from(c).map(([u,t])=>E(u,h).then(n=>(t.forEach(d=>d[0]?.(n)),n)).catch(n=>(t.forEach(d=>d[1]?.(n)),n))))},get:E,open:x,setTtl(b){return p=Number(b),this}}};var ce=(()=>{let a=null,s=!1,r=[],g=(h,c)=>new Promise(u=>{let t=new Image;t.onload=()=>{h.src=t.src,h.width=t.naturalWidth,h.height=t.naturalHeight,P.complete("image"),t.remove(),u()},t.src=c}),p=h=>{r.push({url:h.getAttribute("data-src"),res:c=>g(h,c),rej:()=>P.invalid("image")})},x=h=>{h.onerror=()=>P.invalid("image"),h.onload=()=>{h.width=h.naturalWidth,h.height=h.naturalHeight,P.complete("image")},h.complete&&h.naturalWidth!==0&&h.naturalHeight!==0?P.complete("image"):h.complete&&P.invalid("image")},E=()=>s,k=async()=>{let h=Array.from(a);if(h.filter(t=>t.getAttribute("data-fetch-img")!=="high").forEach(t=>{t.hasAttribute("data-src")?p(t):x(t)}),!s)return;let c=X("images"),u=new Promise(t=>document.addEventListener("progress.invalid",t));await c.open(),await Promise.allSettled(h.filter(t=>t.getAttribute("data-fetch-img")==="high").map(t=>c.get(t.getAttribute("data-src"),u).then(n=>g(t,n)).then(()=>t.classList.remove("opacity-0")))),await c.run(r,u)};return{init:()=>(a=document.querySelectorAll("img"),a.forEach(P.add),s=Array.from(a).some(h=>h.hasAttribute("data-src")),{load:k,hasDataSrc:E})}})();var ae=(()=>{let a=null,s=null,r=null,g=!1,p='<i class="fa-solid fa-circle-pause spin-button"></i>',x='<i class="fa-solid fa-circle-play"></i>',E=async()=>{if(navigator.onLine){a.disabled=!0;try{await r,await s.play(),g=!0,a.disabled=!1,a.innerHTML=p}catch(h){g=!1,alert(h)}}},k=()=>{g=!1,s.pause(),a.innerHTML=x};return{init:async()=>{a=document.getElementById("button-music"),document.addEventListener("undangan.open",()=>{a.style.display="block"});try{let h=new Promise(u=>document.addEventListener("progress.invalid",u)),c=await X("audio").get(a.getAttribute("data-url"),h);s=new Audio(c),s.volume=1,s.loop=!0,s.muted=!1,s.currentTime=0,s.autoplay=!1,s.controls=!1,r=new Promise(u=>s.addEventListener("canplay",u)),P.complete("audio")}catch{P.invalid("audio")}a.addEventListener("offline",k),a.addEventListener("click",()=>g?k():E())},play:E}})();var y=(()=>{let a='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',s=t=>String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),r=(t,n)=>(t.replaceChildren(document.createRange().createContextualFragment(n)),t),g=(t,n,d=.05)=>new Promise(T=>{let v=parseFloat(t.style.opacity),A=n?1:0,S=()=>{v+=n?d:-d,v=Math.max(0,Math.min(1,v)),t.style.opacity=v.toFixed(2),n&&v>=A||!n&&v<=A?(t.style.opacity=A.toString(),T(t)):requestAnimationFrame(S)};requestAnimationFrame(S)}),p=(t,n)=>{let d=null;d=setTimeout(()=>{t(),clearTimeout(d),d=null},n)};return{loader:a,copy:async(t,n=null,d=1500)=>{let T=t.getAttribute("data-copy");if(!T||T.length===0){alert("Nothing to copy");return}t.disabled=!0;try{await navigator.clipboard.writeText(T)}catch{t.disabled=!1,alert("Failed to copy");return}let v=t.innerHTML;r(t,n||'<i class="fa-solid fa-check"></i>'),p(()=>{t.disabled=!1,t.innerHTML=v},d)},timeOut:p,debounce:(t,n)=>{let d=null;return(...T)=>{clearTimeout(d),d=setTimeout(()=>t(...T),n)}},escapeHtml:s,base64Encode:t=>{let d=new TextEncoder().encode(t);return window.btoa(String.fromCharCode(...d))},base64Decode:t=>{let n=new TextDecoder,d=Uint8Array.from(window.atob(t),T=>T.charCodeAt(0));return n.decode(d)},disableButton:(t,n="Loading",d=!1)=>{t.disabled=!0;let T=t.innerHTML;return r(t,d?n:a+n),{restore:(v=!1)=>{t.innerHTML=T,t.disabled=v}}},disableCheckbox:t=>{t.disabled=!0;let n=document.querySelector(`label[for="${t.id}"]`),d=n.innerHTML;return r(n,a+d),{restore:()=>{n.innerHTML=d,t.disabled=!1}}},safeInnerHTML:r,parseUserAgent:t=>{let n=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],d=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],T=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],v=n.find(f=>f.regex.test(t))?.type||"Unknown",A=d.find(f=>f.regex.test(t))?.name||"Unknown",S=T.find(f=>f.regex.test(t)),m=S&&t.match(S.regex)?.[1]?.replace(/_/g,".")||"",o=S?S.name:"Unknown";return m=m?`${o} ${m}`:o,`${A} ${v} ${m}`},changeOpacity:g}})();var fe={tab:r=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(r)),modal:r=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(r))};var H=a=>{let s=(E=null)=>{let k=JSON.parse(localStorage.getItem(a));return E?k[String(E)]:k},r=(E,k)=>{let b=s();b[String(E)]=k,localStorage.setItem(a,JSON.stringify(b))},g=E=>Object.keys(s()).includes(String(E)),p=E=>{if(!g(E))return;let k=s();delete k[String(E)],localStorage.setItem(a,JSON.stringify(k))},x=()=>localStorage.setItem(a,"{}");return localStorage.getItem(a)||x(),{set:r,get:s,has:g,clear:x,unset:p}};var ne=(()=>{let a={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},s=["#ffffff","#f8f9fa"],r=["#000000","#212529"],g=!1,p=null,x=null,E=()=>p.set("active","light"),k=()=>p.set("active","dark"),b=v=>{let A=x.getAttribute("content");x.setAttribute("content",v.some(S=>S===A)?a[A]:A)},h=()=>{E(),document.documentElement.setAttribute("data-bs-theme","light"),b(r)},c=()=>{k(),document.documentElement.setAttribute("data-bs-theme","dark"),b(s)},u=(v=null,A=null)=>{let S=p.get("active")==="dark";return v&&A?S?v:A:S};return{init:()=>{switch(p=H("theme"),x=document.querySelector('meta[name="theme-color"]'),p.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?k():E()),document.documentElement.getAttribute("data-bs-theme")){case"dark":k();break;case"light":E();break;default:g=!0}u()?c():h()},spyTop:()=>{let v=S=>S.filter(m=>m.isIntersecting).forEach(m=>{let o=m.target.classList.contains("bg-white-black")?u(r[0],s[0]):u(r[1],s[1]);x.setAttribute("content",o)}),A=new IntersectionObserver(v,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(S=>A.observe(S))},change:()=>u()?h():c(),isDarkMode:u,isAutoMode:()=>g}})();var J=(()=>{let a={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},s=null,r=null,g=null,p=null;return{on(x,E){return p.set(x,E),this},get(){let x=p.get(g);return p.clear(),x},getCountry(){return s},getLocale(){return r},getLanguage(){return g},setDefault(x){let E=!0;a[x]||(E=!1,console.warn("Language not found, please add manually in countryMapping")),s=E?a[x]:"US",g=E?x:"en",r=`${g}_${s}`},init(){p=new Map,this.setDefault(navigator.language.split("-").shift())}}})();var R=(()=>{let a=null,s=()=>a.get("token"),r=h=>a.set("token",h),g=h=>N(Q,"/api/session").body(h).send(F.tokenResponse).then(c=>(c.code===te&&r(c.data.token),c.code===te),()=>!1),p=()=>a.unset("token"),x=()=>String(s()??".").split(".").length===3;return{init:()=>{a=H("session")},guest:()=>N(G,"/api/v2/config").withCache(1e3*60*60*1).token(s()).send().then(h=>{if(h.code!==te)throw new Error("failed to get config.");let c=H("config");for(let[u,t]of Object.entries(h.data))c.set(u,t);return h}),login:g,logout:p,decode:()=>{if(!x())return null;try{return JSON.parse(y.base64Decode(s().split(".")[1]))}catch{return null}},isAdmin:x,setToken:r,getToken:s}})();var ge=(()=>{let a=null,s=!0,r=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],g=()=>s,p=()=>{let u=a.firstElementChild.firstElementChild;u.classList.remove("bg-success"),u.classList.add("bg-danger"),u.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},x=()=>{let u=a.firstElementChild.firstElementChild;u.classList.remove("bg-danger"),u.classList.add("bg-success"),u.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},E=async()=>{s&&(await y.changeOpacity(a,!1),p())},k=()=>{document.querySelectorAll(r.join(", ")).forEach(u=>{u.dispatchEvent(new Event(g()?"online":"offline")),u.setAttribute("data-offline-disabled",g()?"false":"true"),u.tagName==="BUTTON"?g()?u.classList.remove("disabled"):u.classList.add("disabled"):g()?u.removeAttribute("disabled"):u.setAttribute("disabled","true")})},b=()=>{s=!1,p(),y.changeOpacity(a,!0),k()},h=()=>{s=!0,x(),y.timeOut(E,3e3),k()};return{init:()=>{window.addEventListener("online",h),window.addEventListener("offline",b),a=document.createElement("div"),a.classList.add("fixed-top","pe-none"),a.style.cssText="opacity: 0; z-index: 1057;",a.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`,document.body.insertBefore(a,document.body.lastChild)},isOnline:g}})();var M=(()=>{let a="gifs",s="default",r={128:2,256:3,512:4,768:5},g=null,p=null,x=null,E=null,k=!0,b=(i,l,$=null)=>{let C=p.get(i);return l.map(q=>{let{id:D,media_formats:{tinygif:{url:j}},content_description:B}=q;C.pointer===-1||C.pointer===C.col-1?C.pointer=0:C.pointer++;let oe=C.lists.childNodes[C.pointer]??null;return oe?{url:j,res:le=>{oe.insertAdjacentHTML("beforeend",`
                <figure class="gif-figure m-0 position-relative">
                    <button onclick="undangan.comment.gif.click(this, '${C.uuid}', '${D}', '${y.base64Encode(j)}')" class="btn gif-checklist position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                        <i class="fa-solid fa-circle-check"></i>
                    </button>
                    <img src="${le}" class="img-fluid" alt="${y.escapeHtml(B)}" style="width: 100%;">
                </figure>`),$?.step()}}:null})},h=()=>g.open(),c=i=>g.get(i),u=i=>{let l=p.get(i),$=l.lists,C=document.getElementById(`gif-loading-${l.uuid}`),q=document.getElementById(`progress-bar-${l.uuid}`),D=document.getElementById(`progress-info-${l.uuid}`),j=0,B=0;$.setAttribute("data-continue","false"),$.classList.replace("overflow-y-scroll","overflow-y-hidden");let oe=150,re=!1,le=setTimeout(()=>{re||(D.innerText=`${B}/${j}`,$.classList.contains("d-none")||C.classList.replace("d-none","d-flex"))},oe);return{release:()=>{re=!0,clearTimeout(le),$.classList.contains("d-none")||C.classList.replace("d-flex","d-none"),q.style.width="0%",D.innerText=`${B}/${j}`,$.setAttribute("data-continue","true"),$.classList.replace("overflow-y-hidden","overflow-y-scroll")},until:xe=>{j=xe,D.innerText=`${B}/${j}`},step:()=>{B+=1,D.innerText=`${B}/${j}`,q.style.width=Math.min(B/j*100,100).toString()+"%"}}},t=(i,l,$)=>{$={media_filter:"tinygif",client_key:"undangan_app",key:E.get("tenor_key"),country:J.getCountry(),locale:J.getLocale(),...$??{}};let C=Object.keys($).filter(B=>$[B]!==null&&$[B]!==void 0).map(B=>`${B}=${encodeURIComponent($[B])}`).join("&"),q=u(i),D=p.get(i),j=new Promise(B=>{D.reqs.push(B)});D.last=N(G,`https://tenor.googleapis.com/v2${l}?${C}`).withCache().withRetry().withCancel(j).default(Z).then(B=>B.json()).then(B=>{if(B.error)throw new Error(B.error.message);return B.results.length===0?B:(D.next=B?.next,q.until(B.results.length),D.gifs.push(...B.results),g.run(b(i,B.results,q),j))}).catch(B=>{B.name===ee?console.warn("Fetch abort:",B):alert(B)}).finally(()=>q.release())},n=i=>(i=y.escapeHtml(i),`
        <label for="gif-search-${i}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${i}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back(this, '${i}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input type="text" name="gif-search" id="gif-search-${i}" autocomplete="on" class="form-control shadow-sm rounded-4" placeholder="Search for a GIF on Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex flex-column justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${i}">
                <div class="progress w-25" role="progressbar" style="height: 0.5rem;" aria-label="progress bar">
                    <div class="progress-bar" id="progress-bar-${i}" style="width: 0%"></div>
                </div>
                <small class="mt-1 text-theme-auto bg-theme-auto py-0 px-2 rounded-4" id="progress-info-${i}" style="font-size: 0.7rem;"></small>
            </div>
            <div id="gif-lists-${i}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${i}">
            <button onclick="undangan.comment.gif.cancel('${i}')" id="gif-cancel-${i}" class="btn d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-1 rounded-circle border shadow-sm z-1">
                <i class="fa-solid fa-circle-xmark"></i>
            </button>
        </figure>`),d=async i=>{let l=p.get(i);l.reqs.forEach($=>$()),l.reqs.length=0,l.last&&(await l.last,l.last=null)},T=async i=>{await d(i);let l=p.get(i),$=l.col??0,C=0;for(let[q,D]of Object.entries(r))C=D,l.lists.clientWidth>=parseInt(q)&&(l.col=C);if(l.col===null&&(l.col=C),$!==l.col&&(l.pointer=-1,l.limit=l.col*5,l.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(l.col),l.gifs.length!==0)){try{await g.run(b(i,l.gifs))}catch{l.gifs.length=0}$!==l.col&&l.lists.scroll({top:l.lists.scrollHeight,behavior:"instant"}),l.gifs.length===0&&await T(i)}},v=async i=>{let l=p.get(i);if(l.lists.getAttribute("data-continue")!=="true"||!l.next||l.next.length===0)return;let $=l.query&&l.query.trim().length>0,C={pos:l.next,limit:l.limit};$&&(C.q=l.query),l.lists.scrollTop>(l.lists.scrollHeight-l.lists.clientHeight)*.8&&(await T(i),t(i,$?"/search":"/featured",C))},A=async(i,l=null)=>{let $=p.get(i);$.query=l!==null?l:$.query,(!$.query||$.query.trim().length===0)&&($.query=null),$.col=null,$.next=null,$.pointer=-1,$.gifs.length=0,await T(i),t(i,$.query===null?"/featured":"/search",{q:$.query,limit:$.limit})};return{default:s,init:()=>{p=new Map,x=new Map,g=X(a),E=H("config"),E.get("tenor_key")||(k=!1,document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.remove())},get:c,back:async(i,l)=>{let $=y.disableButton(i,y.loader.replace("me-1","me-0"),!0);await d(l),$.restore(),document.getElementById(`gif-form-${l}`).classList.toggle("d-none",!0),document.getElementById(`comment-form-${l}`)?.classList.toggle("d-none",!1)},open:i=>{if(!p.has(i)){y.safeInnerHTML(document.getElementById(`gif-form-${i}`),n(i));let l=document.getElementById(`gif-lists-${i}`);p.set(i,{uuid:i,lists:l,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[]});let $=y.debounce(v,150);l.addEventListener("scroll",()=>$(i));let C=y.debounce(A,850);document.getElementById(`gif-search-${i}`).addEventListener("input",q=>C(i,q.target.value))}return document.getElementById(`gif-form-${i}`).classList.toggle("d-none",!1),document.getElementById(`comment-form-${i}`)?.classList.toggle("d-none",!0),x.has(i)&&x.get(i)(),A(i)},cancel:i=>{let l=document.getElementById(`gif-result-${i}`);l.removeAttribute("data-id"),l.querySelector(`#gif-cancel-${i}`).classList.replace("d-flex","d-none"),l.querySelector("img").remove(),p.get(i).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${i}`).classList.replace("d-none","d-flex")},click:async(i,l,$,C)=>{let q=y.disableButton(i,y.loader.replace("me-1","me-0"),!0),D=document.getElementById(`gif-result-${l}`);D.setAttribute("data-id",$),D.querySelector(`#gif-cancel-${l}`).classList.replace("d-none","d-flex"),D.insertAdjacentHTML("beforeend",`<img src="${await g.get(y.base64Decode(C))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),q.restore(),p.get(l).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${l}`).classList.replace("d-flex","d-none")},remove:async(i=null)=>{i?p.has(i)&&(await d(i),x.delete(i),p.delete(i)):(await Promise.allSettled(Array.from(p.keys()).map(l=>d(l))),x.clear(),p.clear())},isOpen:i=>{let l=document.getElementById(`gif-form-${i}`);return l===null?!1:!l.classList.contains("d-none")},onOpen:(i,l)=>x.set(i,l),isActive:()=>k,getResultId:i=>document.getElementById(`gif-result-${i}`)?.getAttribute("data-id"),buttonCancel:(i=null)=>{let l=document.getElementById(`gif-cancel-${i||s}`);return{show:()=>l.classList.replace("d-none","d-flex"),hide:()=>l.classList.replace("d-flex","d-none"),click:()=>l.dispatchEvent(new Event("click"))}},removeGifSearch:i=>document.querySelector(`[for="gif-search-${i}"]`)?.remove(),removeButtonBack:i=>document.querySelector(`[onclick="undangan.comment.gif.back(this, '${i}')"]`)?.remove(),prepareCache:h}})();var U=(()=>{let a=null,s=null,r=null,g=null,p=300,x=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],E=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,k=e=>(x.forEach(w=>{let L=w[0],I=w[1];e=e.replace(new RegExp(`\\${L}(?=\\S)(.*?)(?<!\\s)\\${L}`,"gs"),I)}),e),b=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${s.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,h=e=>{let w=`<div class="d-flex justify-content-start align-items-center" data-button-action="${e.uuid}">`;return r.get("can_reply")!==!1&&(w+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply('${e.uuid}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),R.isAdmin()&&e.is_admin&&(!e.gif_url||M.isActive())?w+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this, ${e.is_parent?"true":"false"})" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Edit</button>`:a.has(e.uuid)&&r.get("can_edit")!==!1&&(!e.gif_url||M.isActive())&&(w+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this, ${e.is_parent?"true":"false"})" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),R.isAdmin()?w+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:a.has(e.uuid)&&r.get("can_delete")!==!1&&(w+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),w+="</div>",w},c=(e,w)=>{e=y.escapeHtml(e);let L=g.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${y.escapeHtml(w.join(","))}" data-show="${L?"true":"false"}" role="button" class="me-auto ms-1 py-0">${L?"Hide replies":`Show replies (${w.length})`}</a>`},u=e=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${e.uuid}">
            ${h(e)}
            ${e.comments.length>0?c(e.uuid,e.comments.map(w=>w.uuid)):""}
            ${b(e)}
        </div>`,t=e=>!e.ip||!e.user_agent||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${y.escapeHtml(e.ip)} <span class="mb-1 placeholder col-2 rounded-3"></span></p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${y.parseUserAgent(y.escapeHtml(e.user_agent))}</p>
        </div>`,n=e=>e.is_parent?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4"':`class="${g.get("hidden").find(w=>w.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,d=e=>e.is_admin?`<strong class="me-1">${y.escapeHtml(e.name)}</strong><i class="fa-solid fa-certificate text-primary"></i>`:e.is_parent?`<strong class="me-1">${y.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" data-is-presence="${e.presence?"true":"false"}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${y.escapeHtml(e.name)}</strong>`,T=async e=>{let w=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${d(e)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">`;if(e.gif_url)return w+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${await M.get(e.gif_url)}" id="img-gif-${e.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>`;let L=y.escapeHtml(e.comment),I=L.length>p,O=k(I?L.slice(0,p)+"...":L);return w+`
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" data-comment="${y.base64Encode(L)}" id="content-${e.uuid}">${O}</p>
        ${I?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},v=async e=>{let w=await T(e),L=await Promise.all(e.comments.map(I=>v(I)));return`
        <div ${n(e)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">${w}</div>
            ${t(e)}
            ${u(e)}
            <div id="reply-content-${e.uuid}">${L.join("")}</div>
        </div>`};return{init:()=>{a=H("owns"),s=H("likes"),r=H("config"),g=H("comment")},renderEdit:(e,w,L,I)=>{e=y.escapeHtml(e);let O=document.createElement("div");O.classList.add("my-2"),O.id=`inner-${e}`;let _=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${L?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${w?"selected":""}>&#9989; Datang</option>
            <option value="2" ${w?"":"selected"}>&#10060; Berhalangan</option>
        </select>`:""}
        ${I?`${M.isActive()?`<div class="d-none mb-2" id="gif-form-${e}"></div>`:""}`:`<textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`;return y.safeInnerHTML(O,_)},renderReply:e=>{e=y.escapeHtml(e);let w=document.createElement("div");w.classList.add("my-2"),w.id=`inner-${e}`;let L=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${e}">
            <div class="position-relative">
                ${M.isActive()?`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${e}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`:""}
                <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${e}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`;return y.safeInnerHTML(w,L)},renderLoading:E,renderReadMore:c,renderContentMany:e=>M.prepareCache().then(()=>Promise.all(e.map(w=>v(w)))).then(w=>w.join("")),renderContentSingle:e=>M.prepareCache().then(()=>v(e)),convertMarkdownToHTML:k,maxCommentLength:p}})();var pe=()=>new Promise((a,s)=>{let r=document.createElement("script");r.onload=a,r.onerror=s,r.src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.js",r.integrity="sha256-4QOrAnhDOdVsk8o96+LFopk3LK/FIVFI1VKD3gRuhtE=",r.crossOrigin="anonymous",document.head.appendChild(r)}),he=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]}),be=()=>{window.confetti&&window.confetti({origin:{y:1},zIndex:1057})},ye=(a=15)=>{if(!window.confetti)return;let s=a*1e3,r=Date.now()+s,g=he(),p=["#FFC0CB","#FF1493","#C71585"],x=(k,b)=>Math.random()*(b-k)+k,E=()=>{let k=r-Date.now();p.forEach(b=>{window.confetti({particleCount:1,startVelocity:0,ticks:Math.max(50,75*(k/s)),origin:{x:Math.random(),y:Math.abs(Math.random()-k/s)},zIndex:1057,colors:[b],shapes:[g],drift:x(-.5,.5),gravity:x(.5,1),scalar:x(.5,1)})}),k>0&&requestAnimationFrame(E)};requestAnimationFrame(E)},we=a=>{if(!window.confetti)return;let s=Date.now()+25,r=Math.max(.3,Math.min(1,a.getBoundingClientRect().top/window.innerHeight+.2)),g=he(),p=["#FF69B4","#FF1493"],x=()=>{p.forEach(E=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[g],origin:{x:0,y:r},zIndex:1057,colors:[E]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[g],origin:{x:1,y:r},zIndex:1057,colors:[E]})}),Date.now()<s&&requestAnimationFrame(x)};requestAnimationFrame(x)};var W=(()=>{let a=null,s=null,r=async b=>{let h=b.firstElementChild,c=b.lastElementChild,u=b.getAttribute("data-uuid"),t=parseInt(h.getAttribute("data-count-like"));b.disabled=!0,navigator.vibrate&&navigator.vibrate(100),a.has(u)?await N(me,"/api/comment/"+a.get(u)).token(R.getToken()).send(F.statusResponse).then(n=>{n.data.status&&(a.unset(u),c.classList.remove("fa-solid","text-danger"),c.classList.add("fa-regular"),h.setAttribute("data-count-like",String(t-1)))}):await N(Q,"/api/comment/"+u).token(R.getToken()).send(F.uuidResponse).then(n=>{n.code===se&&(a.set(u,n.data.uuid),c.classList.remove("fa-regular"),c.classList.add("fa-solid","text-danger"),h.setAttribute("data-count-like",String(t+1)))}),h.innerText=h.getAttribute("data-count-like"),b.disabled=!1},g=b=>document.querySelector(`button[onclick="undangan.comment.like.love(this)"][data-uuid="${b}"]`),p=async b=>{if(!navigator.onLine)return;let h=Date.now(),c=h-parseInt(b.getAttribute("data-tapTime")),u=b.id.replace("body-content-",""),t=c<300&&c>0,n=!a.has(u)&&b.getAttribute("data-liked")!=="true";t&&n&&(we(b),b.setAttribute("data-liked","true"),await r(g(u)),b.setAttribute("data-liked","false")),b.setAttribute("data-tapTime",h)};return{init:()=>{s=new Map,a=H("likes")},love:r,tapTap:p,getButtonLike:g,addListener:b=>{let h=new AbortController,c=document.getElementById(`body-content-${b}`);c.addEventListener("touchend",()=>p(c),{signal:h.signal}),s.set(b,h)},removeListener:b=>{let h=s.get(b);h&&(h.abort(),s.delete(b))}}})();var V=(()=>{let a=10,s=0,r=0,g=null,p=null,x=null,E=null,k=null,b=o=>{a=Number(o)},h=()=>a,c=()=>s,u=()=>r,t=()=>p.classList.contains("disabled")?null:p.classList.add("disabled"),n=()=>p.classList.contains("disabled")?p.classList.remove("disabled"):null,d=()=>x.classList.contains("disabled")?null:x.classList.add("disabled"),T=()=>x.classList.contains("disabled")?x.classList.remove("disabled"):null,v=o=>{d(),t();let f=y.disableButton(o,y.loader.replace("ms-0 me-1","mx-1"),!0),e=()=>{k.addEventListener("comment.done",()=>f.restore(),{once:!0}),k.addEventListener("comment.result",()=>k.scrollIntoView(),{once:!0}),k.dispatchEvent(new Event("comment.show"))};return{next:()=>{s+=a,o.innerHTML="Next"+o.innerHTML,e()},prev:()=>{s-=a,o.innerHTML=o.innerHTML+"Prev",e()}}};return{init:()=>{E=document.getElementById("pagination"),E.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page"></span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,k=document.getElementById("comments"),g=document.getElementById("page"),p=document.getElementById("previous"),x=document.getElementById("next")},setPer:b,getPer:h,getNext:c,reset:()=>s===0?!1:(s=0,d(),t(),!0),setTotal:o=>{if(r=Number(o),r<=a&&s===0){E.classList.add("d-none");return}let f=s/a+1,e=Math.ceil(r/a);if(g.innerText=`${f} / ${e}`,s>0&&n(),f>=e){d();return}T(),E.classList.contains("d-none")&&E.classList.remove("d-none")},geTotal:u,previous:o=>v(o).prev(),next:o=>v(o).next()}})();var ie=(()=>{let a=null,s=null,r=null,g=[],p=()=>`<div class="text-center p-4 mx-0 mt-0 mb-3 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">${J.on("id","\u{1F4E2} Yuk, share undangan ini biar makin rame komentarnya! \u{1F389}").on("en","\u{1F4E2} Let's share this invitation to get more comments! \u{1F389}").get()}</p></div>`,x=(m,o)=>{document.querySelector(`[data-button-action="${m}"]`).childNodes.forEach(f=>{f.disabled=o})},E=m=>{x(m,!1),document.getElementById(`inner-${m}`).remove()},k=m=>{let o=m.getAttribute("data-uuids").split(","),f=m.getAttribute("data-show")==="true",e=m.getAttribute("data-uuid");f?(m.setAttribute("data-show","false"),m.innerText=`Show replies (${o.length})`,s.set("show",s.get("show").filter(w=>w!==e))):(m.setAttribute("data-show","true"),m.innerText="Hide replies",s.set("show",s.get("show").concat([e])));for(let w of o){s.set("hidden",s.get("hidden").map(I=>(I.uuid===w&&(I.show=!f),I)));let L=document.getElementById(w).classList;f?L.add("d-none"):L.remove("d-none")}},b=(m,o)=>{let f=document.getElementById(`content-${o}`),e=y.base64Decode(f.getAttribute("data-comment")),w=m.getAttribute("data-show")==="false";y.safeInnerHTML(f,U.convertMarkdownToHTML(w?e:e.slice(0,U.maxCommentLength)+"...")),m.innerText=w?"Sebagian":"Selengkapnya",m.setAttribute("data-show",w?"true":"false")},h=async m=>{if(!R.isAdmin()||(m.comments&&await Promise.all(m.comments.map(f=>h(f))),!m.ip||!m.user_agent||m.is_admin))return;let o=f=>{let e=document.getElementById(`ip-${y.escapeHtml(m.uuid)}`);y.safeInnerHTML(e,`<i class="fa-solid fa-location-dot me-1"></i>${y.escapeHtml(m.ip)} <strong>${y.escapeHtml(f)}</strong>`)};await N(G,`https://freeipapi.com/api/json/${m.ip}`).withCache().withRetry().default(Z).then(f=>f.json()).then(f=>{let e=f.cityName+" - "+f.regionName;f.cityName==="-"&&f.regionName==="-"&&(e="localhost"),o(e)}).catch(f=>o(f.message))},c=(m,o=[])=>(m.forEach(f=>{o.find(e=>e.uuid===f.uuid)||o.push(F.commentShowMore(f.uuid)),f.comments&&f.comments.length>0&&c(f.comments,o)}),o),u=()=>(g.forEach(m=>{W.removeListener(m)}),r.getAttribute("data-loading")==="false"&&(r.setAttribute("data-loading","true"),r.innerHTML=U.renderLoading().repeat(V.getPer())),N(G,`/api/v2/comment?per=${V.getPer()}&next=${V.getNext()}&lang=${J.getLanguage()}`).token(R.getToken()).send(F.getCommentsResponseV2).then(async m=>{r.setAttribute("data-loading","false");for(let f of g)await M.remove(f);if(m.data.lists.length===0)return r.innerHTML=p(),m;g.length=0,g.push(...c(m.data.lists).map(f=>f.uuid)),s.set("hidden",c(m.data.lists,s.get("hidden")));let o=await U.renderContentMany(m.data.lists);return m.data.lists.length<V.getPer()&&(o+=p()),y.safeInnerHTML(r,o),g.forEach(f=>{W.addListener(f)}),m}).then(async m=>(r.dispatchEvent(new Event("comment.result")),m.data.lists&&await Promise.all(m.data.lists.map(o=>h(o))),V.setTotal(m.data.count),r.dispatchEvent(new Event("comment.done")),m)));return{gif:M,like:W,pagination:V,init:()=>{M.init(),W.init(),U.init(),V.init(),r=document.getElementById("comments"),r.addEventListener("comment.show",u),a=H("owns"),s=H("comment"),s.has("hidden")||s.set("hidden",[]),s.has("show")||s.set("show",[])},send:async m=>{let o=m.getAttribute("data-uuid"),f=document.getElementById("form-name"),e=f.value;if(e.length===0){alert("Name cannot be empty."),o&&f.scrollIntoView({block:"center"});return}let w=document.getElementById("form-presence");if(!o&&w&&w.value==="0"){alert("Please select your attendance status.");return}let L=M.isOpen(o||M.default),I=M.getResultId(o||M.default),O=M.buttonCancel(o);if(L&&!I){alert("Gif cannot be empty.");return}L&&I&&O.hide();let _=document.getElementById(`form-${o?`inner-${o}`:"comment"}`);if(!L&&_.value?.trim().length===0){alert("Comments cannot be empty.");return}!o&&f&&!R.isAdmin()&&(f.disabled=!0),!R.isAdmin()&&w&&w.value!=="0"&&(w.disabled=!0),_&&(_.disabled=!0);let z=document.querySelector(`[onclick="undangan.comment.cancel(this, '${o}')"]`);z&&(z.disabled=!0);let K=y.disableButton(m),Y=w?w.value==="1":!0;if(!R.isAdmin()){let l=H("information");l.set("name",e),o||l.set("presence",Y)}let i=await N(Q,`/api/comment?lang=${J.getLanguage()}`).token(R.getToken()).body(F.postCommentRequest(o,e,Y,L?null:_.value,I)).send(F.getCommentResponse).then(l=>l,()=>null);if(f&&(f.disabled=!1),_&&(_.disabled=!1),z&&(z.disabled=!1),w&&(w.disabled=!1),L&&I&&O.show(),K.restore(),!(!i||i.code!==se)){if(a.set(i.data.uuid,i.data.own),_&&(_.value=null),L&&I&&O.click(),!o){if(V.reset()){await u(),r.scrollIntoView();return}V.setTotal(V.geTotal()+1),r.children.length===V.getPer()&&r.lastElementChild.remove(),i.data.is_parent=!0,i.data.is_admin=R.isAdmin();let l=await U.renderContentMany([i.data]);r.insertAdjacentHTML("afterbegin",l),r.scrollIntoView()}if(o){s.set("hidden",s.get("hidden").concat([F.commentShowMore(i.data.uuid,!0)])),s.set("show",s.get("show").concat([o])),E(o),i.data.is_parent=!1,i.data.is_admin=R.isAdmin(),document.getElementById(`reply-content-${o}`).insertAdjacentHTML("beforeend",await U.renderContentSingle(i.data));let l=document.getElementById(`button-${o}`).querySelector("a"),$=[i.data.uuid];l&&(l.getAttribute("data-show")==="false"&&k(l),l.remove());let C=document.createRange().createContextualFragment(U.renderReadMore(o,l?l.getAttribute("data-uuids").split(",").concat($):$)),q=W.getButtonLike(o);q.parentNode.insertBefore(C,q)}W.addListener(i.data.uuid),g.push(i.data.uuid)}},edit:async(m,o)=>{let f=m.getAttribute("data-uuid");x(f,!0),R.isAdmin()&&a.set(f,m.getAttribute("data-own"));let e=document.getElementById(`badge-${f}`),w=!!e&&e.getAttribute("data-is-presence")==="true",L=document.getElementById(`img-gif-${f}`);L&&await M.remove(f);let I=o&&!R.isAdmin();if(document.getElementById(`button-${f}`).insertAdjacentElement("afterend",U.renderEdit(f,w,I,!!L)),L){M.onOpen(f,()=>{M.removeGifSearch(f),M.removeButtonBack(f)}),M.open(f);return}let O=document.getElementById(`form-inner-${f}`),_=y.base64Decode(document.getElementById(`content-${f}`)?.getAttribute("data-comment"));O.value=_,O.setAttribute("data-original",y.base64Encode(_))},reply:async m=>{x(m,!0),await M.remove(m),M.onOpen(m,()=>M.removeGifSearch(m)),document.getElementById(`button-${m}`).insertAdjacentElement("afterend",U.renderReply(m))},remove:async m=>{if(!confirm("Are you sure?"))return;let o=m.getAttribute("data-uuid");R.isAdmin()&&a.set(o,m.getAttribute("data-own")),x(o,!0);let f=y.disableButton(m),e=W.getButtonLike(o);if(e.disabled=!0,!await N(ue,"/api/comment/"+a.get(o)).token(R.getToken()).send(F.statusResponse).then(L=>L.data.status,()=>!1)){f.restore(),e.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(L=>{let I=L.getAttribute("data-uuids").split(",");if(I.find(O=>O===o)){let O=I.filter(_=>_!==o).join(",");O.length===0?L.remove():L.setAttribute("data-uuids",O)}}),a.unset(o),document.getElementById(o).remove(),r.children.length===0&&(r.innerHTML=p())},update:async m=>{let o=m.getAttribute("data-uuid"),f=!1,e=document.getElementById(`form-inner-presence-${o}`);e&&(e.disabled=!0,f=e.value==="1");let w=document.getElementById(`badge-${o}`),L=!!w&&w.getAttribute("data-is-presence")==="true",I=M.isOpen(o),O=M.getResultId(o),_=M.buttonCancel(o);if(I&&!O){alert("Gif cannot be empty.");return}I&&O&&_.hide();let z=document.getElementById(`form-inner-${o}`);if(o&&!I&&y.base64Encode(z.value)===z.getAttribute("data-original")&&L===f){E(o);return}if(!I&&z.value?.trim().length===0){alert("Comments cannot be empty.");return}z&&(z.disabled=!0);let K=document.querySelector(`[onclick="undangan.comment.cancel(this, '${o}')"]`);K&&(K.disabled=!0);let Y=y.disableButton(m),i=await N(de,`/api/comment/${a.get(o)}?lang=${J.getLanguage()}`).token(R.getToken()).body(F.updateCommentRequest(e?f:null,I?null:z.value,O)).send(F.statusResponse).then(l=>l.data.status,()=>!1);if(z&&(z.disabled=!1),K&&(K.disabled=!1),e&&(e.disabled=!1),Y.restore(),I&&O&&_.show(),!!i){if(I&&O&&(document.getElementById(`img-gif-${o}`).src=document.getElementById(`gif-result-${o}`)?.querySelector("img").src,_.click()),E(o),!I){let l=document.querySelector(`[onclick="undangan.comment.showMore(this, '${o}')"]`),$=y.escapeHtml(z.value),C=document.getElementById(`content-${o}`);C.setAttribute("data-comment",y.base64Encode($));let q=U.convertMarkdownToHTML($);q.length>U.maxCommentLength?(y.safeInnerHTML(C,l?.getAttribute("data-show")==="false"?q.slice(0,U.maxCommentLength)+"...":q),l?.classList.replace("d-none","d-block")):(y.safeInnerHTML(C,q),l?.classList.replace("d-block","d-none"))}e&&(document.getElementById("form-presence").value=f?"1":"2",H("information").set("presence",f)),!(!e||!w)&&(w.classList.toggle("fa-circle-xmark",!f),w.classList.toggle("text-danger",!f),w.classList.toggle("fa-circle-check",f),w.classList.toggle("text-success",f))}},cancel:async(m,o)=>{let f=document.getElementById(`form-inner-presence-${o}`),e=f?f.value==="1":!1,w=document.getElementById(`badge-${o}`),L=w&&a.has(o)&&f?w.getAttribute("data-is-presence")==="true":!1;if(y.disableButton(m),M.isOpen(o)&&(!M.getResultId(o)&&L===e||confirm("Are you sure?"))){await M.remove(o),E(o);return}let I=document.getElementById(`form-inner-${o}`);(I.value.length===0||y.base64Encode(I.value)===I.getAttribute("data-original")&&L===e||confirm("Are you sure?"))&&E(o)},show:u,showMore:b,showOrHide:k}})();var ve=(()=>{let a=null,s=()=>{let n=document.getElementById("count-down")?.getAttribute("data-time")?.replace(" ","T");if(!n){alert("Invalid countdown date.");return}let d=new Date(n).getTime(),T=()=>{let v=Math.abs(d-Date.now());document.getElementById("day").innerText=Math.floor(v/(1e3*60*60*24)).toString(),document.getElementById("hour").innerText=Math.floor(v%(1e3*60*60*24)/(1e3*60*60)).toString(),document.getElementById("minute").innerText=Math.floor(v%(1e3*60*60)/(1e3*60)).toString(),document.getElementById("second").innerText=Math.floor(v%(1e3*60)/1e3).toString(),y.timeOut(T,1e3-Date.now()%1e3)};requestAnimationFrame(T)},r=()=>{let n=window.location.search.split("to="),d=null;if(n.length>1&&n[1].length>=1&&(d=window.decodeURIComponent(n[1])),d){let v=document.getElementById("guest-name"),A=document.createElement("div");A.classList.add("m-2");let S=`<small class="mt-0 mb-1 mx-0 p-0">${y.escapeHtml(v?.getAttribute("data-message"))}</small><p class="m-0 p-0" style="font-size: 1.5rem">${y.escapeHtml(d)}</p>`;y.safeInnerHTML(A,S),v?.appendChild(A)}let T=document.getElementById("form-name");T&&(T.value=a.get("name")??d)},g=async()=>{let n=0,d=0,T=6e3,v=document.querySelectorAll(".slide-desktop");for(let[m,o]of v.entries())if(m===n){o.classList.add("slide-desktop-active"),await y.changeOpacity(o,!0);break}let A=async()=>{await y.changeOpacity(v[n],!1),v[n].classList.remove("slide-desktop-active"),n=(n+1)%v.length,v[n].classList.add("slide-desktop-active"),await y.changeOpacity(v[n],!0)},S=async m=>{m-d>=T&&(d=m,await A()),requestAnimationFrame(S)};y.timeOut(S,T)},p=n=>{n.disabled=!0,document.body.scrollIntoView({behavior:"instant"}),document.dispatchEvent(new Event("undangan.open")),ne.isAutoMode()&&(document.getElementById("button-theme").style.display="block"),g(),ae.play(),ne.spyTop(),be(),y.timeOut(ye,1500),y.changeOpacity(document.getElementById("welcome"),!1).then(d=>d.remove())},x=n=>{let d=document.getElementById("show-modal-image");d.src=n.src,d.width=n.width,d.height=n.height,fe.modal("modal-image").show()},E=()=>a.set("info",!0),k=()=>{document.querySelectorAll(".font-arabic").forEach(n=>{n.innerHTML=String(n.innerHTML).normalize("NFC")})},b=()=>{document.querySelectorAll("svg").forEach(n=>{y.timeOut(()=>n.classList.add(n.getAttribute("data-class")),parseInt(n.getAttribute("data-time")))})},h=()=>{let n=v=>new Date(v+":00Z").toISOString().replace(/[-:]/g,"").split(".").shift(),d=new URL("https://calendar.google.com/calendar/render"),T={action:"TEMPLATE",text:"The Wedding of Wahyu and Riski",dates:`${n("2023-03-15 10:00")}/${n("2023-03-15 11:00")}`,details:"Tanpa mengurangi rasa hormat, kami mengundang Anda untuk berkenan menghadiri acara pernikahan kami. Terima kasih atas perhatian dan doa restu Anda, yang menjadi kebahagiaan serta kehormatan besar bagi kami.",location:"https://goo.gl/maps/ALZR6FJZU3kxVwN86",ctz:"Asia/Jakarta"};Object.entries(T).forEach(([v,A])=>d.searchParams.set(v,A)),document.querySelector("#home button")?.addEventListener("click",()=>window.open(d,"_blank"))},c=async()=>{b(),s(),r(),k(),h(),document.getElementById("root").style.opacity="1",a.has("presence")&&(document.getElementById("form-presence").value=a.get("presence")?"1":"2"),a.get("info")&&document.getElementById("information")?.remove(),window.AOS.init(),document.body.scrollIntoView({behavior:"instant"}),await y.changeOpacity(document.getElementById("welcome"),!0),await y.changeOpacity(document.getElementById("loading"),!1).then(n=>n.remove())},u=()=>{J.init(),ge.init(),P.init(),a=H("information");let n=document.body.getAttribute("data-key");if(document.addEventListener("progress.done",()=>c()),document.addEventListener("hide.bs.modal",()=>document.activeElement?.blur()),(!n||n.length<=0)&&(P.add(),ce.init().load(),ae.init(),document.getElementById("comment")?.remove(),document.querySelector('a.nav-link[href="#comment"]')?.closest("li.nav-item")?.remove()),n&&n.length>0){P.add(),P.add(),P.add(),P.add();let d=ce.init();d.hasDataSrc()||d.load();let T=new URLSearchParams(window.location.search);R.setToken(T.get("k")??n),window.addEventListener("load",()=>R.guest().then(()=>{P.complete("config"),d.hasDataSrc()&&d.load(),ae.init(),ie.init(),pe().then(()=>P.complete("confetti")).catch(()=>P.invalid("confetti")),ie.show().then(()=>P.complete("comment")).catch(()=>P.invalid("comment"))}).catch(()=>P.invalid("config")))}};return{init:()=>(ne.init(),R.init(),R.isAdmin()&&(H("user").clear(),H("owns").clear(),H("likes").clear(),H("session").clear(),H("comment").clear(),H("tracker").clear()),window.addEventListener("DOMContentLoaded",u),{util:y,theme:ne,comment:ie,guest:{open:p,modal:x,closeInformation:E}})}})();(a=>{a.undangan=ve.init()})(window);})();
